import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

# -----------------------------------------------------------------------------
# 1. í˜ì´ì§€ ì„¤ì • ë° ë¡œê·¸ì¸
# -----------------------------------------------------------------------------
st.set_page_config(page_title="2026ë…„ë„ ì¬ê³ ì¡°ì‚¬ ê´€ë¦¬ ì‹œìŠ¤í…œ", layout="wide")

PASSWORD = "1234" 

if "authenticated" not in st.session_state:
    st.session_state.authenticated = False

def check_password():
    if st.session_state.password_input == PASSWORD:
        st.session_state.authenticated = True
        del st.session_state.password_input
    else:
        st.error("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.")

if not st.session_state.authenticated:
    st.title("ğŸ”’ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤")
    st.write("ê´€ê³„ì ì™¸ ì ‘ê·¼ì„ ì œí•œí•©ë‹ˆë‹¤.")
    st.text_input("ì ‘ì† ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”", type="password", key="password_input", on_change=check_password)
    st.stop() 

# =============================================================================
# ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì‹¤í–‰
# =============================================================================
st.title("ğŸ“Š 2026ë…„ë„ ì¬ê³ ì¡°ì‚¬ ê´€ë¦¬ ì‹œìŠ¤í…œ")

# -----------------------------------------------------------------------------
# 2. ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
# -----------------------------------------------------------------------------
@st.cache_data(ttl=600)
def load_data():
    try:
        file_url = st.secrets["excel_url"]
        
        # êµ¬ê¸€ ë“œë¼ì´ë¸Œ ë§í¬ ë³€í™˜ ë¡œì§
        if "/file/d/" in file_url:
            parts = file_url.split("/file/d/")
            if len(parts) > 1:
                file_id = parts[1].split("/")[0]
                download_url = f"https://drive.google.com/uc?export=download&id={file_id}"
            else:
                return None, None, "ë§í¬ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
        elif "/spreadsheets/d/" in file_url:
            parts = file_url.split("/spreadsheets/d/")
            if len(parts) > 1:
                file_id = parts[1].split("/")[0]
                download_url = f"https://docs.google.com/spreadsheets/d/{file_id}/export?format=xlsx"
            else:
                return None, None, "ë§í¬ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
        else:
            return None, None, "ì˜¬ë°”ë¥¸ êµ¬ê¸€ ë“œë¼ì´ë¸Œ ê³µìœ 
